<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="m-0">Danh s√°ch s·∫£n ph·∫©m</h4>
    <div class="d-flex gap-2">
      <input
        type="text"
        id="searchProduct"
        class="form-control"
        placeholder="üîç T√¨m ki·∫øm..."
      />
      <button class="btn btn-primary" id="btnAddProduct">+ Th√™m</button>
    </div>
  </div>

  <div class="card shadow-sm">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover table-bordered align-middle mb-0">
          <thead>
            <tr class="text-center bg-light">
              <th>M√£ SP</th>
              <th>T√™n s·∫£n ph·∫©m</th>
              <th>Thao t√°c</th>
            </tr>
          </thead>
          <tbody id="productTable"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Modal th√™m/s·ª≠a -->
<div class="modal fade" id="productModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="productModalTitle">Th√™m s·∫£n ph·∫©m</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
        ></button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="editProductId" />
        <div class="mb-3">
          <label class="form-label">M√£ s·∫£n ph·∫©m</label>
          <input type="text" id="productCode" class="form-control" readonly />
        </div>
        <div class="mb-3">
          <label class="form-label">T√™n s·∫£n ph·∫©m</label>
          <input type="text" id="productName" class="form-control" />
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
        <button class="btn btn-primary" id="saveProduct">L∆∞u</button>
      </div>
    </div>
  </div>
</div>

<script>
  $(function () {
    // D·ªØ li·ªáu ban ƒë·∫ßu
    let products =
      JSON.parse(localStorage.getItem("products")) || fakeDB.PRODUCT;

    function saveLocal() {
      localStorage.setItem("products", JSON.stringify(products));
    }

    function renderTable(list) {
      let html = "";
      list.forEach((p) => {
        html += `
          <tr>
            <td class="text-center">${p.CODE}</td>
            <td>${p.NAME}</td>
            <td class="text-center">
              <button class="btn btn-sm btn-warning btnEdit" data-id="${p.ID}">S·ª≠a</button>
              <button class="btn btn-sm btn-danger btnDelete" data-id="${p.ID}">X√≥a</button>
            </td>
          </tr>`;
      });
      $("#productTable").html(html);
    }

    renderTable(products);

    // üîç T√¨m ki·∫øm
    $("#searchProduct").on("keyup", function () {
      const kw = $(this).val().toLowerCase();
      const filtered = products.filter(
        (p) =>
          p.CODE.toLowerCase().includes(kw) || p.NAME.toLowerCase().includes(kw)
      );
      renderTable(filtered);
    });

    // ‚ûï Th√™m
    $("#btnAddProduct").click(() => {
      $("#editProductId").val("");
      $("#productModalTitle").text("Th√™m s·∫£n ph·∫©m");
      const nextCode = "P" + String(products.length + 1).padStart(3, "0");
      $("#productCode").val(nextCode);
      $("#productName").val("");
      $("#productModal").modal("show");
    });

    // üíæ L∆∞u
    $("#saveProduct").click(() => {
      const id = $("#editProductId").val();
      const name = $("#productName").val().trim();
      if (!name) {
        alert("Vui l√≤ng nh·∫≠p t√™n s·∫£n ph·∫©m!");
        return;
      }

      if (id) {
        // C·∫≠p nh·∫≠t
        const idx = products.findIndex((p) => p.ID == id);
        if (idx !== -1) products[idx].NAME = name;
      } else {
        // Th√™m m·ªõi
        const newProduct = {
          ID: products.length + 1,
          CODE: $("#productCode").val(),
          NAME: name,
        };
        products.push(newProduct);
      }

      saveLocal();
      renderTable(products);
      $("#productModal").modal("hide");
    });

    // ‚úèÔ∏è S·ª≠a
    $(document).on("click", ".btnEdit", function () {
      const id = $(this).data("id");
      const prod = products.find((p) => p.ID == id);
      if (!prod) return;
      $("#editProductId").val(prod.ID);
      $("#productModalTitle").text("Ch·ªânh s·ª≠a s·∫£n ph·∫©m");
      $("#productCode").val(prod.CODE);
      $("#productName").val(prod.NAME);
      $("#productModal").modal("show");
    });

    // üóëÔ∏è X√≥a
    $(document).on("click", ".btnDelete", function () {
      const id = $(this).data("id");
      if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a s·∫£n ph·∫©m n√†y?")) {
        products = products.filter((p) => p.ID != id);
        saveLocal();
        renderTable(products);
      }
    });
  });
</script>
